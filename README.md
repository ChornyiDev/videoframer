# VideoFramer

VideoFramer - це сервіс для обробки відео, який автоматично витягує ключові кадри, транскрибує аудіо та генерує описовий контент для блогерів та контент-мейкерів.

## Швидкий старт

1. Клонуйте репозиторій:
```bash
git clone https://github.com/yourusername/videoframer.git
cd videoframer
```

2. Створіть віртуальне середовище та встановіть залежності:
```bash
python -m venv .venv
source .venv/bin/activate  # для Linux/Mac
pip install -r requirements.txt
```

3. Встановіть FFmpeg:
```bash
# Mac
brew install ffmpeg

# Ubuntu
sudo apt-get update
sudo apt-get install ffmpeg
```

4. Створіть файл .env з необхідними змінними оточення:
```env
OPENAI_API_KEY=your-api-key
REDIS_URL=redis://localhost:6379
WEBHOOK_URL=your-webhook-url
```

5. Запустіть Redis:
```bash
redis-server
```

6. Запустіть Celery worker:
```bash
celery -A celery_worker.celery_app worker --loglevel=info
```

7. Запустіть FastAPI сервер:
```bash
uvicorn app.main:app --reload
```

Сервіс буде доступний за адресою: http://localhost:8000

## Функціональність

- Завантаження відео за URL
- Витяг ключових кадрів з відео
- Транскрипція аудіо за допомогою OpenAI Whisper
- Генерація описового контенту на основі кадрів та транскрипції
- Асинхронна обробка з використанням Celery
- Кешування результатів у Redis
- Відправка результатів через вебхуки

## Структура проекту

```
videoframer/
├── app/
│   ├── core/
│   │   ├── celery_app.py    # Конфігурація Celery
│   │   ├── config.py        # Налаштування застосунку
│   │   └── redis_client.py  # Клієнт Redis для кешування
│   ├── services/
│   │   └── video_service.py # Сервіс обробки відео
│   └── main.py             # FastAPI застосунок
├── .env                    # Змінні оточення
└── celery_worker.py       # Воркер Celery
```

## Конфігурація

Налаштування здійснюється через змінні оточення в файлі `.env`:

```env
OPENAI_API_KEY=your-api-key
REDIS_URL=redis://localhost:6379
WEBHOOK_URL=your-webhook-url
```

### Основні налаштування (config.py)

- `MAX_VIDEO_SIZE`: Максимальний розмір відео (50MB)
- `MAX_FRAMES`: Максимальна кількість кадрів (8)
- `JPEG_QUALITY`: Якість JPEG (70)
- `CACHE_EXPIRE_TIME`: Час життя кешу (24 години)
- `CELERY_TASK_TIME_LIMIT`: Ліміт часу завдання (2 хвилини)
- `CELERY_WORKER_CONCURRENCY`: Кількість паралельних завдань (2)

### Правила витягу кадрів

- Відео до 30 секунд: кадри кожні 5 секунд
- Відео 30-60 секунд: кадри кожні 10 секунд
- Відео довше 60 секунд: кадри кожні 20 секунд

## Оптимізації

1. **Мережеві оптимізації:**
   - Обмеження розміру відео (50MB)
   - GZIP стиснення для API відповідей
   - Валідація відео перед завантаженням

2. **Оптимізації обробки:**
   - Зменшення розміру кадрів до 512px
   - Оптимізація якості JPEG
   - Конвертація аудіо в моно з бітрейтом 48k

3. **Кешування:**
   - Кешування результатів обробки в Redis
   - Унікальні ключі кешу на основі URL та промпту
   - Автоматичне очищення кешу після 24 годин

## Вимоги до системи

- Python 3.8+
- Redis
- FFmpeg
- OpenAI API ключ

## Залежності

Основні залежності проекту:
```
fastapi
celery
redis
httpx
python-dotenv
moviepy
Pillow
openai
```

## Моніторинг та логування

- Детальне логування процесу обробки відео
- Логування помилок вебхуків
- Моніторинг статусу завдань Celery

## Обробка помилок

- Валідація розміру та формату відео
- Обробка помилок завантаження
- Обробка помилок транскрипції
- Обробка помилок вебхуків

## Безпека

- Валідація URL відео
- Обмеження розміру файлів
- Безпечне зберігання API ключів
- Тимчасові директорії для файлів
